let:
  - exe: .build-trash/build/x86_64-linux/ghcjs-8.4.0.1/gui-0.1.0.0/x/gui/build/gui/gui.jsexe/

default: sae build

init: npm i && sae pre

freshBuild: sae init prod_

code: (/Applications/Visual\ Studio\ Code.app/Contents/MacOS/Electron .&) && ghcid

ghc: nix-shell -A shells.ghc
ghcjs: nix-shell -A shells.ghcjs

html: cp src/index.html build

pre: mkdir -p .build-trash build

move: cp @exe?all.js build/app.js

js: cabal --project-file=cabal-ghcjs.project --builddir=.build-trash new-build gui

minify: echo 'Optimizing... may take some time' && node_modules/.bin/ccjs @exe?all.js --compilation_level=ADVANCED_OPTIMIZATIONS --jscomp_off=checkVars --externs=@exe?all.js.externs > @exe?all.min.js && rm @exe?all.js && mv @exe?all.min.js @exe?all.js

build: sae pre js html move
build_: nix-shell -A shells.ghcjs --run "sae build"

prod: sae pre html js minify move
prod_: nix-shell -A shells.ghcjs --run "sae prod"m