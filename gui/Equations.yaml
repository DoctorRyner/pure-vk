default: sae build

init: npm i && sae pre

freshBuild: sae init prod_

code: (/Applications/Visual\ Studio\ Code.app/Contents/MacOS/Electron .&) && ghcid

ghc: nix-shell -A shells.ghc
ghcjs: nix-shell -A shells.ghcjs

html: cp src/index.html build

pre: mkdir -p .build-trash build

js: ghcjs -outputdir .build-trash -dedupe -DGHCJS_BROWSER -o .build-trash/app src/Main.hs

move: mv .build-trash/app.jsexe/all.js build/app.js

build: sae pre html js move
build_: nix-shell -A shells.ghcjs --run "sae build"

prod: sae pre html js minify move
prod_: nix-shell -A shells.ghcjs --run "sae prod"

minify: echo 'Optimizing... may take some time' && cd .build-trash/app.jsexe && ../../node_modules/.bin/ccjs all.js --compilation_level=ADVANCED_OPTIMIZATIONS --jscomp_off=checkVars --externs=all.js.externs > all.min.js && rm all.js && mv all.min.js all.js